var Horyu=window.Horyu||{};Horyu.View=window.Horyu.View||{};
Horyu.View.Lottery=function(f){var a=this;a.nextLotteryPrize=null;a.options=$.extend({prizeList:[]},f);a.init=function(){a.updateTable();a.bindEvents();setInterval(function(){$("#currentTime").text(moment().format("YYYY\ub144 MMMM D\uc77c dddd A h\uc2dc mm\ubd84 ss\ucd08"))},500);var c=new CountUp("applyCount",0,a.options.applyCount,0,3,{useEasing:!0,useGrouping:!0,separator:",",decimal:".",prefix:"\ucd1d ",suffix:"\uba85"});c.error?console.error(c.error):c.start()};a.updateTable=function(){a.nextLotteryPrize=
null;var c=$("#prize-table tbody");c.empty();var b=a.options.prizeList.groupBy("companyId");Object.forEach(b,function(b){b=b.sortBy("prizeId");var g=0;Object.forEach(b,function(d){var e=$("\x3ctr\x3e");if(0===g){var f=$('\x3ctd class\x3d"company-cell" rowspan\x3d"'+b.length+'"\x3e\x3ca style\x3d"font-size: 16pt;font-weight: bold;"\x3e'+d.companyName+'\x3c/a\x3e\x3cbr/\x3e\x3ca style\x3d"color: gray"\x3e'+d.companyDetail+"\x3c/a\x3e\x3c/td\x3e");e.append(f)}e.append($("\x3ctd\x3e").text(d.prizeName));
null===d.applicant?(e.append($("\x3ctd\x3e").html('\x3ca style\x3d"color:gray"\x3e\ucd94\ucca8 \ub300\uae30 \uc911\x3c/a\x3e')),e.append($("\x3ctd\x3e").html('\x3ca style\x3d"color:gray"\x3e\ucd94\ucca8 \ub300\uae30 \uc911\x3c/a\x3e')),null===a.nextLotteryPrize&&(a.nextLotteryPrize=d)):(e.append($("\x3ctd\x3e").html('\x3ca style\x3d"color:blue;font-weight: bold"\x3e'+a.hideSomePartOfEmail(d.applicant.email)+"\x3c/a\x3e")),e.append($("\x3ctd\x3e").html('\x3ca style\x3d"color:blue;font-weight: bold"\x3e'+
d.applicant.youtubeNickname+"\x3c/a\x3e")));c.append(e);g++})});null===a.nextLotteryPrize?($(".lotteryBtn").attr("disabled",""),$(".lotteryBtn").html('\x3ci class\x3d"fas fa-random"\x3e\x3c/i\x3e\x26nbsp; [\ucd94\ucca8 \ubd88\uac00] \ubaa8\ub4e0 \uc0c1\ud488 \ucd94\ucca8\uc774 \uc644\ub8cc\ub418\uc5c8\uc2b5\ub2c8\ub2e4.')):$(".lotteryBtn").html('\x3ci class\x3d"fas fa-random"\x3e\x3c/i\x3e\x26nbsp; \ub2e4\uc74c \uc0c1\ud488 ('+a.nextLotteryPrize.companyName+" - "+a.nextLotteryPrize.prizeName+") \ucd94\ucca8\ud558\uae30")};
a.bindEvents=function(){$(".lotteryBtn").click(function(){if(a.isIE())$("#ie-modal").modal({backdrop:"static",keyboard:!1});else{$(".lotteryBtn").attr("disabled","");$(".lotteryBtn").html('\x3ci class\x3d"fas fa-spinner fa-pulse"\x3e\x3c/i\x3e\x26nbsp; \ucd94\ucca8 \uc911\uc785\ub2c8\ub2e4...');var c=moment();$.ajax({type:"POST",url:"./lottery",data:{prizeId:a.nextLotteryPrize.prizeId},timeout:12E4}).done(function(b){var f=moment();5E3<=moment.duration(f.diff(c)).valueOf()?a.lotteryOut(b):setTimeout(function(){a.lotteryOut(b)},
Math.round(3E3*Math.random())+3E3)}).fail(function(a){$(".lotteryBtn").html('\x3ci class\x3d"fas fa-exclamation-triangle"\x3e\x3c/i\x3e\x26nbsp; \ucd94\ucca8\uc5d0 \uc2e4\ud328\ud558\uc600\uc2b5\ub2c8\ub2e4.');$(".lotteryBtn").removeClass("btn-success");$(".lotteryBtn").addClass("btn-danger");setTimeout(function(){location.reload()},4E3)})}})};a.lotteryOut=function(c){$(".lotteryBtn").html("\uc5f4\ub9b0 \ucc3d\uc744 \ud655\uc778\ud574\uc8fc\uc138\uc694.");$("#modal-companyName").text(a.nextLotteryPrize.companyName);
$("#modal-companyDetail").text(a.nextLotteryPrize.companyDetail);$("#modal-prizeName").text(a.nextLotteryPrize.prizeName);$("#modal-youtubeNickname").text(c.youtubeNickname);$("#modal-email").text(a.hideSomePartOfEmail(c.email));$("#lottery-modal").modal({backdrop:"static",keyboard:!1})};a.hideSomePartOfEmail=function(a){var b=a.split("@")[0],b=b.substr(0,b.length-1)+"*";a=a.split("@")[1].replace(/[a-zA-Z\uac00-\ud7a3]/g,"*");return b+"@"+a};a.isIE=function(){var a=window.navigator.userAgent.toLowerCase();
return"netscape"===navigator.appName.toLowerCase()&&-1!==a.search("trident")||-1!==a.indexOf("msie")?!0:!1};return{init:function(){a.init()}}};